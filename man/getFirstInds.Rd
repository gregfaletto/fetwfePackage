% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/did_funcs.R
\name{getFirstInds}
\alias{getFirstInds}
\title{Get Indices of First Treatment Effects for Each Cohort}
\usage{
getFirstInds(R, T)
}
\arguments{
\item{R}{Integer; the number of treated cohorts.}

\item{T}{Integer; the total number of time periods.}
}
\value{
An integer vector of length \code{R}, where \code{f_inds[r]} is the 1-based
starting index of the \code{r}-th cohort's treatment effects in the combined block.
}
\description{
Calculates the starting indices of treatment effect parameters for each cohort
within a concatenated block of all treatment effects. This is used for constructing
fusion penalty matrices.
}
\details{
Assumes treatment for cohort \code{r} (where \code{r} is 1-indexed for calculation,
corresponding to actual adoption times \code{times[r+1]}) starts at \code{times[r+1]}
and continues until \code{times[T]}.
The number of treatment effects for cohort \code{r} is \code{T - (r+1) + 1 = T - r}.
The \code{num_treats} is the sum of these counts.
The formula for the starting index of the \code{r}-th cohort's treatment effects
(1-indexed \code{r} from 1 to \code{R}):
\verb{f_inds[r] = 1 + sum_\{k=1\}^\{r-1\} (T - k) = 1 + (r-1)T - (r-1)r/2}.

Gemini check:
The paper's formula \code{1 + (r - 1)*(2*T - r)/2} seems to be for a slightly
different definition of \code{num_treats} or indexing. This function should align
with how \code{treat_var_mat} is constructed in \code{addDummies} and \code{num_treats}
is calculated there.
Let's re-evaluate the formula based on typical DiD setups:
Cohort 1 (starts at time 2) has T-1 effects.
Cohort 2 (starts at time 3) has T-2 effects.
...
Cohort R (starts at time R+1) has T-R effects.
\code{first_inds[1] = 1}
\code{first_inds[2] = (T-1) + 1}
\code{first_inds[3] = (T-1) + (T-2) + 1}
So, \verb{first_inds[r] = 1 + sum_\{j=1\}^\{r-1\} (T-j)}.

The current code uses: \code{f_inds[r] <- 1 + (r - 1)*(2*T - r)/2}.
Let's test this formula:
r=1: 1
r=2: 1 + 1*(2T-2)/2 = 1 + T - 1 = T
r=3: 1 + 2*(2T-3)/2 = 1 + 2T - 3 = 2T - 2
This implies the number of effects for cohort 1 is T-1 (indices 1 to T-1).
Number of effects for cohort 2 is (2T-2) - T = T-2.
This seems to match the sequence T-1, T-2, ..., T-R.
Total number of treats (\code{num_treats}) from \code{getNumTreats(R,T)} is \code{T*R - R*(R+1)/2}.
This is \verb{sum_\{j=1 to R\} (T-j)}. This is consistent.
}
\keyword{internal}
